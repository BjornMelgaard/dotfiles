# dotfiles
features: i3, neovim

# how to install on new computer

```sh
# INSTALL SOFTWARE
echo '{ allowUnfree = true; }' > ~/.config/nixpkgs/config.nix
nix-env -i git vscode
code --user-data-dir=/tmp/code --install-extension bbenoist.Nix

# MAKE PARTITIONS
gdisk /dev/sdb
# make 3 partitions: efi (code - ef00, last sector - +2M), swap (code - 8200, last sector - +8G), nixos (code - default, last sector - default)
mkfs.vfat -L efi /dev/sdb1
mkswap -L swap /dev/sdb2
mkfs.ext4 -L nixos /dev/sdb3

# MOUNT
swapon /dev/sdb2
mount /dev/disk/by-label/nixos /mnt
mkdir /mnt/boot
mount /dev/sdb2 /mnt/boot
mkswap -L swap /dev/sdb2

# GENERATE CONFIGURATION
nixos-generate-config --root /mnt

# CLONE DOTFILES
mkdir -p /mnt/home/bjorn/.config
git clone https://github.com/BjornMelgaard/dotfiles /mnt/home/bjorn/.config/dotfiles

# BACKUP AUTOGENERATED CONFIGURATIONS
mv /mnt/etc/nixos/configuration.nix /mnt/etc/nixos/configuration.nix.old
mv /mnt/etc/nixos/hardware-configuration.nix /mnt/etc/nixos/hardware-configuration.nix.old

# COPY hardware-configuration.nix to dotfiles to easily modify it later
cp /mnt/etc/nixos/hardware-configuration.nix.old /mnt/home/bjorn/.config/dotfiles/nixos/root/hardware-configuration.nix

# LINK CONFIGS TO CONFIGS IN DOTFILES
# this configuration path to dotfiles your system will use after reboot
printf "rec {\n  dotfilesDir=/mnt/home/bjorn/.config/dotfiles;\n}" > /etc/nixos/metaconfiguration.nix

# this configuration is used only during installation inside livecd, because a lot of dotfiles files have `import /etc/nixos/metaconfiguration.nix` hardcoded
printf "rec {\n  dotfilesDir=/home/bjorn/.config/dotfiles;\n}" > /mnt/etc/nixos/metaconfiguration.nix

# import DOTFILES/nixos/root/default.nix inside   
printf "with (import /etc/nixos/metaconfiguration.nix);\nimport \"\${dotfilesDir}/nixos/root/default.nix\"" > /mnt/etc/nixos/configuration.nix

mkdir -p /mnt/home/bjorn/.config/nixpkgs
printf "with (import /etc/nixos/metaconfiguration.nix);\nimport \"\${dotfilesDir}/nixos/home/config.nix\"" > /mnt/home/bjorn/.config/nixpkgs/config.nix

# MODIFY HARDWARE CONFIGURATION IF YOU WANT
code --user-data-dir=/tmp/code /mnt/home/bjorn/.config/dotfiles /mnt/etc/nixos/

# INSTALL
nixos-install --root /mnt
```
